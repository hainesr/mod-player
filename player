#!/usr/bin/env ruby
# frozen_string_literal: true

# Copyright (c) 2018, 2019 Robert Haines.
#
# Licensed under the BSD License. See LICENCE for details.

lib = File.expand_path('lib', __dir__)
$LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib)

require 'rubygems'
require 'bundler/setup'

require 'mod_player/player'

options = ModPlayer::Player.read_opts(ARGV)

saved_err = STDERR.dup
STDERR.reopen(File.new('/dev/null', 'w'))

player = ModPlayer::Player.new(options)

at_exit do
  STDERR.reopen(saved_err)
  player.stop
end

player.play
